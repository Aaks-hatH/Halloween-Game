<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>The Locked Dungeon</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
<style>
  /* Basic reset + look */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: linear-gradient(180deg,#0a0a0a 0%,#1a0a0a 60%,#0a0a0a 100%);
    color: #ff8c00;
    font-family: "Creepster", cursive, sans-serif;
    text-align: center;
    padding: 30px;
    min-height: 100vh;
  }
/*
  MIT License

Copyright (c) 2025 Aaks-hatH

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
  /* Visual elements */
  h1 { font-size: clamp(2rem,5vw,3rem); margin-bottom: 8px; text-shadow:0 0 20px #ff4500; }
  .subtitle { margin-bottom: 14px; opacity: .9; }
  .riddle-container { max-width: 900px; margin: 18px auto; display: grid; grid-template-columns: 1fr; gap: 18px; }
  .riddle-card {
    background: linear-gradient(135deg, rgba(20,20,20,.95), rgba(30,15,10,.95));
    border: 1px solid rgba(255,140,0,.2);
    padding: 18px;
    border-radius: 14px;
  }
  .riddle-canvas { display:block; margin: 0 auto 12px; border-radius:8px; box-shadow: 0 6px 20px rgba(0,0,0,.6); background:#0a0a0a;}
  .riddle-controls { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }
  input[type=text] {
    padding:10px 14px; border-radius:10px; border:2px solid rgba(255,140,0,.3);
    background: rgba(10,10,10,.85); color: #ff8c00; width: 220px; font-family: inherit; text-align:center;
  }
  button { padding:10px 18px; border-radius:10px; border:none; font-weight:bold; cursor:pointer; background: linear-gradient(135deg,#ff8c00,#ff6600); color:#0a0a0a; }
  #progressFill { height:30px; width:0%; display:flex; align-items:center; justify-content:center; border-radius:8px; background: linear-gradient(90deg,#ff8c00,#ff6600); color:#0a0a0a; font-weight:bold; }
  .progress-bar { width:100%; background: rgba(10,10,10,.8); border-radius:8px; border:1px solid rgba(255,140,0,.2); padding:3px; margin-bottom:12px; }

  /* Hint box and result */
  #hintBox { display:none; max-width:760px; margin:12px auto; padding:12px; background: rgba(10,10,10,.95); border-radius:8px; border:1px solid rgba(255,140,0,.2); }
  #result { margin-top:10px; min-height:26px; }

  /* Credits */
  .credits {
    margin-top: 60px;
    padding: 30px 20px;
    max-width: 760px;
    margin-left: auto;
    margin-right: auto;
    background: linear-gradient(135deg, rgba(20,20,20,.8), rgba(30,15,10,.8));
    border: 1px solid rgba(255,140,0,.15);
    border-radius: 14px;
  }
  .credits h3 {
    color: #ff8c00;
    font-size: 1.8rem;
    margin-bottom: 20px;
    text-shadow: 0 0 10px #ff4500;
  }
  .credits-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    font-family: sans-serif;
  }
  .credit-item {
    color: #ffb366;
    font-size: 1.1rem;
    line-height: 1.5;
  }
  .credit-name {
    color: #ff8c00;
    font-weight: bold;
    font-size: 1.2rem;
  }
  .credit-role {
    color: #cc7700;
    font-style: italic;
  }

  /* Disable text selection for elements that show riddle text (deterrent) */
  .no-select {
    -webkit-user-select: none; -moz-user-select:none; -ms-user-select:none; user-select:none;
  }

  /* Animation for warning overlay */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }

  @keyframes flash {
    0%, 100% { background: rgba(139, 0, 0, 1); }
    50% { background: rgba(200, 0, 0, 1); }
  }

  /* Small screens */
  @media (max-width:640px) {
    input[type=text] { width: 150px; }
  }
</style>
</head>
<body>

<h1>💀 The Locked Dungeon</h1>
<p class="subtitle">Solve the five riddles. The first letter of each answer spells the final code.</p>

<!-- Progress -->
<div class="progress-card riddle-card">
  <div style="max-width:760px;margin:0 auto;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <strong>Progress</strong>
      <small id="progressText">0 / 5 solved</small>
    </div>
    <div class="progress-bar"><div id="progressFill" style="width:0%">0/5</div></div>
  </div>
</div>

<!-- Riddles - each will have a canvas rendering -->
<div class="riddle-container" id="riddleContainer">
  <!-- Cards will be injected by JS -->
</div>

<!-- Final code area -->
<div class="riddle-card" style="max-width:760px;margin:16px auto;">
  <h3 style="margin-bottom:12px;">Enter the Final Code</h3>
  <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
    <input id="codeInput" type="text" maxlength="5" placeholder="5-letter code (A..Z)">
    <button id="unlockBtn">Unlock</button>
  </div>
  <p id="result"></p>
</div>

<!-- Hint button + hintbox -->
<div style="margin:12px auto 40px;max-width:760px;">
  <button id="hintBtn">💡 Need a Hint?</button>
  <div id="hintBox"></div>
</div>

<!-- Credits Section -->
<div class="credits">
  <h3>🎃 Credits 🎃</h3>
  <div class="credits-list">
    <div class="credit-item">
      <span class="credit-name">Aakshat Hariharan</span><br>
      <span class="credit-role">Developer & Creator</span>
    </div>
    <div class="credit-item">
      <span class="credit-name">Kory Alerte</span><br>
      <span class="credit-role">Co-Creator & Author</span>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  // Encoded data - riddles and answers stored as base64 to prevent easy viewing
  // Answer for riddle 4 changed from Z (zombie) to U (undead)
  const encodedData = 'W3siaWQiOjEsInRpdGxlIjoiUmlkZGxlIDEiLCJ0ZXh0IjoiSSBoYXZlIG5vIGJvZHksIGJ1dCBJIGNhbiBhcHBlYXIsXG5JIHdoaXNwZXIgaW4geW91ciBlYXIsIGJ1dCB2YW5pc2ggbmVhci5cblxuWW91J2xsIGZlZWwgbXkgY2hpbGwgdGhvdWdoIEkgYW0gYWlyLFxuV2hhdCBhbSBJLCBoYXVudGluZyBldmVyeXdoZXJlPyIsImFuc3dlciI6IkcifSx7ImlkIjoyLCJ0aXRsZSI6IlJpZGRsZSAyIiwidGV4dCI6IkkgYW0gZnVsbCBvZiBnaG9zdHMsIGNvYndlYnMsIGFuZCBmcmlnaHQsXG5QZW9wbGUgdmlzaXQgbWUgb24gSGFsbG93ZWVuIG5pZ2h0LlxuRGFyayBhbmQgc3Bvb2t5IGlzIG15IHN0eWxlLFxuV2hhdCBhbSBJPyIsImFuc3dlciI6IkgifSx7ImlkIjozLCJ0aXRsZSI6IlJpZGRsZSAzIiwidGV4dCI6IlJvdW5kIGFuZCBob2xsb3csIGRhcmsgbXkgY29yZSxcbkkgb3BlbiB3aWRlIGJ1dCBoYXZlIG5vIGRvb3IuXG5XaXRob3V0IG1lLCBmYWNlcyBjYW5ub3Qgc2VlXG5XaGF0IGxldHRlciBhbSBJIG1lYW50IHRvIGJlP1xuKEhpbnQ6IFRoZSBsZXR0ZXIgaXMgYSBTaGFwZSkiLCJhbnN3ZXIiOiJPIn0seyJpZCI6NCwidGl0bGUiOiJSaWRkbGUgNCIsInRleHQiOiJOZWl0aGVyIGxpdmluZyBub3IgcXVpdGUgZGVhZCxcbkkgcmlzZSBhZ2FpbiB3aGVuIG1vb25saWdodCdzIHNoZWQuXG5JIHNoYW1ibGUgc2xvdywgd2l0aCB2YWNhbnQgaHVlXG5HdWVzcyBteSBuYW1lLiIsImFuc3dlciI6IlUifSx7ImlkIjo1LCJ0aXRsZSI6IlJpZGRsZSA1IiwidGV4dCI6IkkgbGl2ZSBpbnNpZGUgYSBoYXVudGVkIGZsYW1lLFxuV2l0aG91dCBtZSwgZGFyayB3b3VsZCBydWxlIHRoZSBnYW1lLlxuSSBmbGlja2VyIHNvZnQsIEkgZ3VhcmQgeW91ciBzb3VsXG5XaGF0IGFtIEksIHdpdGggc2hpbmluZyByb2xlPyIsImFuc3dlciI6IkwifV0=';
  
  const encodedHints = 'eyIxIjoiVGhpbmsgb2YgYSBjaGlsbGluZyBwcmVzZW5jZSB0aGF0IGhhcyBubyBwaHlzaWNhbCBib2R5LiIsIjIiOiJBIHBsYWNlIHBlb3BsZSB2aXNpdCBvbiBIYWxsb3dlZW4gd2hlcmUgc2NhcnkgdGhpbmdzIGFyZSBkaXNwbGF5ZWQsIHR3byB3b3Jkcy4iLCIzIjoiQSByb3VuZCBsZXR0ZXIgdGhhdCBpcyBhbHNvIGEgc2hhcGUuIiwiNCI6IkEgd29yZCBmb3IgdGhlIGNhdGVnb3J5IGEgd2Fsa2luZyBkZWFkIGNyZWF0dXJlIGlzIGNsYXNzaWZpZWQgYXMuIiwiNSI6IkEgc291cmNlIG9mIGZsaWNrZXJpbmcgaWxsdW1pbmF0aW9uIHRoYXQga2VlcHMgdGhlIGRhcmsgYXdheS4ifQ==';
  
  // Decode function
  function decode(str) {
    try {
      return JSON.parse(atob(str));
    } catch(e) {
      return null;
    }
  }
  
  const riddles = decode(encodedData);
  const hints = decode(encodedHints);
  
  if (!riddles || !hints) {
    document.body.innerHTML = '<h1>Error loading puzzle</h1>';
    return;
  }

  // Internal state
  const solved = {1:false,2:false,3:false,4:false,5:false};

  // Helper: remove zero-width and similar invisible chars
  function stripZeroWidth(str) {
    return str.replace(/[\u200B\u200C\u200D\uFEFF\u2060]/g, '');
  }

  function containsZeroWidth(str) {
    return /[\u200B\u200C\u200D\uFEFF\u2060]/.test(str);
  }

  /* --------------- Canvas rendering --------------- */
  function createRiddleCard(r) {
    const card = document.createElement('div');
    card.className = 'riddle-card';
    card.id = 'card-' + r.id;

    // Title
    const h = document.createElement('h3');
    h.textContent = r.title;
    card.appendChild(h);

    // Canvas element (riddle displayed as image)
    const canvas = document.createElement('canvas');
    canvas.className = 'riddle-canvas no-select';
    const width = Math.min(760, Math.max(320, Math.floor(window.innerWidth * 0.85)));
    const lineHeight = 26;
    const padding = 18;
    const lines = r.text.split('\n').length + 1;
    const height = padding*2 + lines * lineHeight + 40;
    canvas.width = width;
    canvas.height = height;
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    canvas.setAttribute('aria-hidden','true');
    card.appendChild(canvas);

    // Controls: input + submit
    const controls = document.createElement('div');
    controls.className = 'riddle-controls';
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'answer' + r.id;
    input.placeholder = 'Your answer';
    input.autocomplete = 'off';
    input.spellcheck = false;
    input.setAttribute('aria-label','Answer for ' + r.title);

    // Prevent paste completely
    input.addEventListener('paste', (ev) => {
      ev.preventDefault();
      alert('Pasting is disabled. Please type your answer.');
    });

    // Prevent copy
    input.addEventListener('copy', (ev) => {
      ev.preventDefault();
    });

    // Prevent cut
    input.addEventListener('cut', (ev) => {
      ev.preventDefault();
    });

    const submit = document.createElement('button');
    submit.textContent = 'Submit';
    submit.type = 'button';
    submit.onclick = () => checkRiddle(r.id);

    const feedback = document.createElement('div');
    feedback.id = 'feedback' + r.id;
    feedback.style.minHeight = '22px';
    feedback.style.marginTop = '10px';
    feedback.style.color = '#ff8c00';

    controls.appendChild(input);
    controls.appendChild(submit);
    card.appendChild(controls);
    card.appendChild(feedback);

    drawRiddleOnCanvas(canvas, r.title, r.text);

    return card;
  }

  function drawRiddleOnCanvas(canvas, title, text) {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#0a0a0a';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle = 'rgba(255,140,0,0.18)';
    ctx.lineWidth = 2;
    roundRect(ctx, 2, 2, canvas.width-4, canvas.height-4, 10);
    ctx.stroke();

    ctx.fillStyle = '#ff8c00';
    const titleSize = Math.min(28, Math.floor(canvas.width / 22));
    ctx.font = `bold ${titleSize}px Creepster, sans-serif`;
    ctx.textAlign = 'left';
    ctx.fillText(title, 20, 38);

    ctx.fillStyle = '#ffb366';
    const fontSize = Math.min(18, Math.floor(canvas.width / 40));
    ctx.font = `${fontSize}px sans-serif`;
    const x = 20;
    let y = 64;
    const maxWidth = canvas.width - 40;
    const lines = text.split('\n');
    for (const line of lines) {
      wrapDrawText(ctx, line, x, y, maxWidth, fontSize + 8);
      y += (fontSize + 8) * (Math.ceil(ctx.measureText(line).width / maxWidth) || 1);
    }

    ctx.font = '20px serif';
    ctx.fillStyle = 'rgba(255,255,255,0.08)';
    ctx.fillText('🕸️', canvas.width - 46, 36);
  }

  function roundRect(ctx, x, y, width, height, radius) {
    ctx.beginPath();
    ctx.moveTo(x+radius, y);
    ctx.arcTo(x+width, y, x+width, y+height, radius);
    ctx.arcTo(x+width, y+height, x, y+height, radius);
    ctx.arcTo(x, y+height, x, y, radius);
    ctx.arcTo(x, y, x+width, y, radius);
    ctx.closePath();
  }

  function wrapDrawText(ctx, text, x, y, maxWidth, lineHeight) {
    const words = text.split(' ');
    let line = '';
    for (let n = 0; n < words.length; n++) {
      const testLine = line + words[n] + ' ';
      const metrics = ctx.measureText(testLine);
      if (metrics.width > maxWidth && n > 0) {
        ctx.fillText(line, x, y);
        line = words[n] + ' ';
        y += lineHeight;
      } else {
        line = testLine;
      }
    }
    ctx.fillText(line, x, y);
  }

  /* --------------- Append all riddle cards --------------- */
  const container = document.getElementById('riddleContainer');
  riddles.forEach(r => {
    container.appendChild(createRiddleCard(r));
  });

  /* --------------- Checking logic --------------- */
  function updateProgressDisplay() {
    const solvedCount = Object.values(solved).filter(Boolean).length;
    const pct = (solvedCount/5) * 100;
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressFill').textContent = `${solvedCount}/5`;
    document.getElementById('progressText').textContent = `${solvedCount} / 5 solved`;
  }

  function checkRiddle(id) {
    const inp = document.getElementById('answer' + id);
    const fb = document.getElementById('feedback' + id);
    if (!inp) return;
    let val = (inp.value || '').trim();
    val = stripZeroWidth(val);
    if (!val) {
      fb.style.color = '#ff4444';
      fb.textContent = 'Please type an answer.';
      return;
    }
    const first = val[0].toUpperCase();
    const expected = riddles.find(r => r.id === id).answer.toUpperCase();
    if (first === expected) {
      solved[id] = true;
      fb.style.color = '#00cc66';
      fb.textContent = '✓ Correct — nice work.';
      inp.disabled = true;
      const card = document.getElementById('card-' + id);
      if (card) card.style.borderColor = 'rgba(0,255,0,0.18)';
      updateProgressDisplay();
    } else {
      fb.style.color = '#ff4444';
      fb.textContent = '✗ Incorrect — try again.';
      setTimeout(() => { fb.textContent = ''; }, 3000);
    }
  }

  /* --------------- Code checking --------------- */
  function getFinalCode() {
    return riddles.map(r => r.answer[0].toUpperCase()).join('');
  }

  document.getElementById('unlockBtn').addEventListener('click', () => {
    const codeInput = document.getElementById('codeInput');
    const res = document.getElementById('result');
    const entered = stripZeroWidth((codeInput.value || '').trim().toUpperCase());
    if (!entered) {
      res.style.color = '#ff8c00';
      res.textContent = 'Enter the 5-letter code to escape!';
      return;
    }
    if (entered.length !== 5) {
      res.style.color = '#ff4444';
      res.textContent = 'Code must be 5 letters.';
      return;
    }
    const target = getFinalCode();
    if (entered === target) {
      res.style.color = '#00cc66';
      res.textContent = 'You have escaped the dungeon! The spirits bow to your wisdom.';
    } else {
      res.style.color = '#ff4444';
      res.textContent = 'Wrong code... The dungeon remains locked.';
    }
  });

  // Prevent paste on code input too
  document.getElementById('codeInput').addEventListener('paste', (ev) => {
    ev.preventDefault();
    alert('Pasting is disabled. Please type your answer.');
  });

  /* --------------- Hints --------------- */
  document.getElementById('hintBtn').addEventListener('click', () => {
    const rn = prompt('Which riddle do you want a hint for? (1-5) — enter a number');
    const hb = document.getElementById('hintBox');
    if (!rn) {
      hb.style.display = 'none'; 
      hb.innerHTML = '';
      return;
    }
    const n = parseInt(rn);
    if (hints[n]) {
      hb.style.display = 'block';
      hb.innerHTML = `<p class="no-select">💡 Hint for Riddle ${n}: ${hints[n]}</p>`;
    } else {
      hb.style.display = 'block';
      hb.innerHTML = `<p class="no-select">That riddle doesn't exist — try a number from 1 to 5.</p>`;
    }
  });

  /* --------------- Enhanced anti-copy/paste deterrents --------------- */
  // Disable right-click context menu
  document.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    return false;
  });

  // Prevent keyboard shortcuts for copy, cut, view source, and dev tools
  document.addEventListener('keydown', (e) => {
    // Prevent Ctrl+C, Ctrl+X, Ctrl+U, F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C
    if (
      (e.ctrlKey && (e.key === 'c' || e.key === 'C')) ||
      (e.ctrlKey && (e.key === 'x' || e.key === 'X')) ||
      (e.ctrlKey && (e.key === 'u' || e.key === 'U')) ||
      (e.ctrlKey && e.shiftKey && (e.key === 'i' || e.key === 'I')) ||
      (e.ctrlKey && e.shiftKey && (e.key === 'j' || e.key === 'J')) ||
      (e.ctrlKey && e.shiftKey && (e.key === 'c' || e.key === 'C')) ||
      e.key === 'F12'
    ) {
      e.preventDefault();
      return false;
    }
  });

  // Disable text selection on the entire page
  document.body.style.userSelect = 'none';
  document.body.style.webkitUserSelect = 'none';
  document.body.style.mozUserSelect = 'none';
  document.body.style.msUserSelect = 'none';

  // But allow selection in input fields
  const inputs = document.querySelectorAll('input[type="text"]');
  inputs.forEach(input => {
    input.style.userSelect = 'text';
    input.style.webkitUserSelect = 'text';
  });

  updateProgressDisplay();

  // Clear console periodically to remove any accidentally logged data
  setInterval(() => {
    console.clear();
  }, 1000);

  /* --------------- Tab Switch Detection & Warning --------------- */
  let tabSwitchCount = 0;
  let firstWarningShown = false;
  let isLocked = false;

  document.addEventListener('visibilitychange', () => {
    if (isLocked) return; // Already locked, ignore further switches
    
    if (document.hidden) {
      // User switched away from the tab
      tabSwitchCount++;
      
      // After 5 tab switches, permanently lock the page
      if (tabSwitchCount >= 5) {
        lockPagePermanently();
      }
    } else {
      // User returned to the tab
      if (tabSwitchCount === 1 && !firstWarningShown) {
        showTabSwitchWarning();
        firstWarningShown = true;
      } else if (tabSwitchCount >= 3 && tabSwitchCount < 5) {
        showSevereWarning();
      }
    }
  });

  function showTabSwitchWarning() {
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease;
    `;

    const warningBox = document.createElement('div');
    warningBox.style.cssText = `
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(70, 0, 0, 0.95));
      border: 3px solid #ff4444;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 0 50px rgba(255, 68, 68, 0.5);
    `;

    warningBox.innerHTML = `
      <h2 style="color: #ff4444; font-size: 2rem; margin-bottom: 20px; font-family: Creepster, cursive;">⚠️ WARNING ⚠️</h2>
      <p style="color: #ffaa66; font-size: 1.1rem; margin-bottom: 20px; line-height: 1.6; font-family: sans-serif;">
        Tab switching detected!<br><br>
        Using external help (like ChatGPT) defeats the purpose of this puzzle.<br><br>
        Try to solve it yourself! 
      </p>
      <p style="color: #ff8c00; font-size: 0.9rem; margin-bottom: 25px; font-family: sans-serif;">
        Switches detected: ${tabSwitchCount}<br>
        <strong style="color: #ff4444;">After 5 switches, the exam will be LOCKED!</strong>
      </p>
      <button id="acknowledgeBtn" style="
        padding: 15px 30px;
        font-size: 1.1rem;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #ff8c00, #ff6600);
        color: #0a0a0a;
        font-weight: bold;
        cursor: pointer;
        font-family: Creepster, cursive;
      ">I Understand</button>
    `;
